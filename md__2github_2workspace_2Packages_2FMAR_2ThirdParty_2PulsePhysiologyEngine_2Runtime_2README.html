<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FirstModulAR: Pulse Unity Asset</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logos.png"/></td>
  <td id="projectalign">
   <div id="projectname">FirstModulAR<span id="projectnumber">&#160;0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__2github_2workspace_2Packages_2FMAR_2ThirdParty_2PulsePhysiologyEngine_2Runtime_2README.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Pulse Unity Asset</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md38"></a></p>
<p>This repository is a collection of assets designed to integrate the <a href="https://pulse.kitware.com">Pulse Physiology Engine</a> within <a href="https://unity3d.com/">Unity3D</a>.</p>
<h1><a class="anchor" id="autotoc_md39"></a>
Platforms Supported</h1>
<ul>
<li>Unity minimum version 2019.4.X LTS</li>
<li>Windows 10 x64</li>
<li>Windows ARM64</li>
<li>ManyLinux 2014 x64</li>
<li>macOS 10.11+</li>
<li>Android ARMv7a</li>
<li>Android ARMv8a</li>
</ul>
<h1><a class="anchor" id="autotoc_md40"></a>
Development</h1>
<p><b>Any contributions to this repository need to be done using Unity 2019.4.X LTS</b></p>
<p>This unity version was chosen as it is Long Term Supported and provides compatibility with all targeted platfroms.</p>
<p>There is no reason why this asset could not be used by earlier versions of Unity, but those don't easily support all of our targeted platforms.</p>
<h1><a class="anchor" id="autotoc_md41"></a>
Installation</h1>
<h2><a class="anchor" id="autotoc_md42"></a>
From the Asset Store</h2>
<p>The Pulse Unity Asset is available for download on the <a href="http://u3d.as/1sp1">Unity Asset Store</a>.</p>
<h2><a class="anchor" id="autotoc_md43"></a>
From a packaged release</h2>
<p>Each release is associated with a <a href="https://docs.unity3d.com/Manual/AssetPackages.html">Unity Asset Package</a> which can be downloaded from our <a href="https://gitlab.kitware.com/physiology/unity/releases">release page</a>.</p>
<h2><a class="anchor" id="autotoc_md44"></a>
From Git</h2>
<h3><a class="anchor" id="autotoc_md45"></a>
Install Git LFS</h3>
<p>This project uses Git LFS for data (.csv, .json state files) and binaries (libraries in <code>Plugins</code>), so ensure that <a href="https://git-lfs.github.com/">Git LFS is installed</a> and that you've run <code>git lfs install</code>.</p>
<h2><a class="anchor" id="autotoc_md46"></a>
Setup the repository inside your Unity project</h2>
<p>To be able to access the Pulse Unity Asset, this whole repository needs to live somewhere under the <code>Assets</code> folder of your Unity project. For example: </p><div class="fragment"><div class="line">YourProject/</div>
<div class="line">  Assembly-CSharp-Editor.csproj</div>
<div class="line">  Assembly-CSharp.csproj</div>
<div class="line">  Assets/</div>
<div class="line">    PulsePhysiologyEngine/ &lt;-- make this folder here</div>
<div class="line">    ...</div>
<div class="line">  Library/</div>
<div class="line">  YourProject.sln</div>
<div class="line">  obj/</div>
<div class="line">  ProjectSettings/</div>
<div class="line">  Temp/</div>
<div class="line">  ...</div>
</div><!-- fragment --><p>Therefore: </p><div class="fragment"><div class="line">mkdir YourProject/Assets/PulsePhysiologyEngine</div>
<div class="line">cd YourProject/Assets/PulsePhysiologyEngine</div>
<div class="line">git clone https://gitlab.kitware.com/physiology/unity .</div>
</div><!-- fragment --><p>If <code>YourProject</code> is version-controlled with Git, you can add our asset as a submodule instead: </p><div class="fragment"><div class="line">mkdir YourProject/Assets/PulsePhysiologyEngine</div>
<div class="line">cd YourProject/Assets/PulsePhysiologyEngine</div>
<div class="line">git submodule add https://gitlab.kitware.com/physiology/unity</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md47"></a>
How to use</h1>
<p>The user manual needs to be embedded in the Unity asset package according to the Unity Asset Store submission guidelines (<a href="https://unity3d.com/asset-store/sell-assets/submission-guidelines#content-organization">section 3.2</a>) and can therefore be found at <a href="/Documentation/PulseUnityAssetUserManual.pdf"><code>Documentation/PulseUnityAssetUserManual.pdf</code></a></p>
<p>To learn more about the Pulse api used by scripts in this repository, check out our <a href="https://gitlab.kitware.com/physiology/engine/-/tree/4.x/src/csharp/howto">C# API Examples</a></p>
<h2><a class="anchor" id="autotoc_md48"></a>
Pulse Data</h2>
<p>One instance of a Pulse Engine simulates 1, and only 1, patient. You can initialize a Pulse patient in 2 ways:</p>
<h3><a class="anchor" id="autotoc_md49"></a>
Load a Pulse Engine state from a previous instance of a Pulse patient.</h3>
<p>This is the easiest and quickest way to start Pulse. This asset provides several <a href="/Data/states">pregenerated patient states for you to use</a> You can use these states to create your own new states as well.</p>
<p>You only need to provide Provide the Pulse API the state file, or its contents. (StreamingAssets are not used when loading from a state file/string!)</p>
<h3><a class="anchor" id="autotoc_md50"></a>
Creating a new Patient in Pulse</h3>
<p>If you wish to define your own patient, you may do so with the Pulse API. When doing so, Pulse will need to read files from disk. If you are doing this within Unity, you will need to copy the <a href="/Data">Data</a> directory into your applications StreamingAssets folder. You can rename it to anything you wish.</p>
<p>You will need to provide the Pulse <a href="https://gitlab.kitware.com/physiology/engine/-/blob/4.x/src/csharp/pulse/engine/PulseEngine.cs#L84">InitializeEngine</a> method the location of this directory in your code, for example:</p>
<div class="fragment"><div class="line"><span class="preprocessor"> #</span></div>
<div class="line"><span class="comment">// Assuming you Copied the Data folder into your StreamingAssets folder and renamed it to &#39;PulseData&#39;</span></div>
<div class="line"><span class="keywordtype">string</span> pulseDataPath = Application.streamingAssetsPath + <span class="stringliteral">&quot;/PulseData/&quot;</span>;</div>
<div class="line">DirectoryInfo directoryInfo = <span class="keyword">new</span> DirectoryInfo(pulseDataPath);</div>
<div class="line"><span class="keywordflow">if</span> (!directoryInfo.Exists)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">string</span> error = <span class="stringliteral">&quot;Data files for Pulse not found. Expected at &quot;</span> + pulseDataPath + <span class="stringliteral">&quot;.\n&quot;</span> +</div>
<div class="line">    <span class="stringliteral">&quot;Make sure you have copied them from the Pulse Data folder to your projects &#39;StreamingAssets&#39; folder.&quot;</span>;</div>
<div class="line">    <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(error);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">if</span> (!engine.InitializeEngine(cfg, data_mgr, pulseDataPath))</div>
<div class="line">      <a class="code hl_typedef" href="BuildWindow_8cs.html#a0100be52d45f14348918ea69ec09f959">Debug</a>.unityLogger.LogError(<span class="stringliteral">&quot;PulsePhysiologyEngine&quot;</span>, <span class="stringliteral">&quot;Unable to initialize Pulse &quot;</span>);</div>
<div class="ttc" id="aBuildWindow_8cs_html_a0100be52d45f14348918ea69ec09f959"><div class="ttname"><a href="BuildWindow_8cs.html#a0100be52d45f14348918ea69ec09f959">Debug</a></div><div class="ttdeci">UnityEngine.Debug Debug</div><div class="ttdef"><b>Definition</b> BuildWindow.cs:9</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md51"></a>
Pulse engine backend</h1>
<p><a href="https://gitlab.kitware.com/physiology/engine/-/releases/">Current version of Pulse engine</a></p>
<h2><a class="anchor" id="autotoc_md52"></a>
Plugins</h2>
<p>Functionality from the C++ API of the Pulse engine are encapsulated in the following <a href="https://docs.unity3d.com/Manual/Plugins.html">plugins</a>:</p><ul>
<li>**PulseC <sup>(native)</sup>:** a <a href="https://gitlab.kitware.com/physiology/engine/-/tree/4.x/src/c">C wrapper</a> for the Pulse engine<ul>
<li><code>.dll</code> for Windows</li>
<li><code>.so</code> for Linux, Lumin and Android</li>
<li><code>.dylib</code> for MacOS</li>
<li><code>.a</code> for Web Assembly</li>
</ul>
</li>
<li>**PulseEngine.dll <sup>(managed)</sup>:** a <a href="https://gitlab.kitware.com/physiology/engine/-/tree/4.x/src/csharp/pulse/engine">C# interface</a> to the Pulse engine implemented by wrapping PulseC</li>
<li>**CommonDataModel.dll <sup>(managed)</sup>:** a <a href="https://gitlab.kitware.com/physiology/engine/-/tree/4.x/src/csharp/pulse/cdm">C# implementation</a> of the <a href="http://pulse.kitware.com/_c_d_m.html">common data model</a></li>
<li>**DataModelBindings.dll <sup>(managed)</sup>:** C# bindings autogenerated by protobuf of the common data model <a href="https://gitlab.kitware.com/physiology/engine/-/tree/4.x/src/schema">schema</a></li>
<li>**Google.Protobuf.dll <sup>(managed)</sup>:** C# library of <a href="https://github.com/protocolbuffers/protobuf/tree/master/csharp/src/Google.Protobuf">protocol-buffers</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md53"></a>
Building the Pulse Asset plugins</h2>
<p>The binaries/plugins above will be built along with the Pulse engine (steps <a href="https://gitlab.kitware.com/physiology/engine#building">here</a>), noting that:</p><ul>
<li>The native plugins (<code>PulseC</code>) need to be built on <b>each of your target platforms</b></li>
<li>The managed plugins can <b>only be built on Windows</b> but will then support every target platform</li>
</ul>
<h1><a class="anchor" id="autotoc_md54"></a>
Limitations</h1>
<h2><a class="anchor" id="autotoc_md55"></a>
IL2CPP Build Support</h2>
<p>The Pulse Unity Asset will not work out of the box in Unity projects built with the <a href="https://docs.unity3d.com/Manual/IL2CPP.html">IL2CPP compiler</a> due to <a href="https://docs.unity3d.com/Manual/IL2CPP-BytecodeStripping.html">bytecode stripping</a>. The provided Pulse plugins are impacted by this (Google Protocol Buffers used in Pulse for serialization), which results in stripping of code that is actually necessary for Pulse. A link.xml file (contents below) should be placed in your assets folder root to effectively disable bytecode stripping by preserving both types and full assemblies. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">linker</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">assembly</span> <span class="keyword">fullname</span>=<span class="stringliteral">&quot;System&quot;</span> <span class="keyword">preserve</span>=<span class="stringliteral">&quot;all&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">assembly</span> <span class="keyword">fullname</span>=<span class="stringliteral">&quot;Google.Protobuf&quot;</span> <span class="keyword">preserve</span>=<span class="stringliteral">&quot;all&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">assembly</span> <span class="keyword">fullname</span>=<span class="stringliteral">&quot;PulseCSharp&quot;</span> <span class="keyword">preserve</span>=<span class="stringliteral">&quot;all&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">linker</span>&gt;</div>
</div><!-- fragment --><p>If you need to use the IL2CPP compiler and it is preventing you from integrating Pulse in your Unity application, let us know on our <a href="https://discourse.kitware.com/c/pulse-physiology-engine">Discourse support forum</a>.</p>
<h2><a class="anchor" id="autotoc_md56"></a>
Missing C++ functionality from the Pulse engine in the C# assets</h2>
<p>The Pulse Unity Asset only exposes a portion of the functionality available in the C++ interface of the Pulse engine. If you need to expose more functionality from the C++ library in Unity, you need to:</p><ol type="1">
<li>Update the C and C# implementations of the plugins listed above. You can contribute those changes to the <a href="https://gitlab.kitware.com/physiology/engine/blob/master/CONTRIBUTING.md">Pulse engine repository</a>.</li>
<li>Build those plugins as described above</li>
<li>Update those files in the <a href="/Plugins">Plugins</a> directory. See the contribution guidelines below to receive reviews and continuous support for your implementation.</li>
</ol>
<p>If you are interested in collaborating with us to bring more of the Pulse engine functionality to Unity, you can contact us at <a href="#" onclick="location.href='mai'+'lto:'+'kit'+'wa'+'re@'+'ki'+'twa'+'re'+'.co'+'m'; return false;">kitwa<span class="obfuscator">.nosp@m.</span>re@k<span class="obfuscator">.nosp@m.</span>itwar<span class="obfuscator">.nosp@m.</span>e.co<span class="obfuscator">.nosp@m.</span>m</a>.</p>
<h2><a class="anchor" id="autotoc_md57"></a>
Using a custom version/fork of PulseEngine?</h2>
<p>Before we can bring any capabilities to the Pulse Unity Asset, they will need to be part of the Pulse Engine repository. You can contribute your changes <a href="https://gitlab.kitware.com/physiology/engine/blob/master/CONTRIBUTING.md">there</a> to facilitate their integration to the Unity Asset in the future. If you need help designing a custom solution based on Pulse, you can contact us at <a href="#" onclick="location.href='mai'+'lto:'+'kit'+'wa'+'re@'+'ki'+'twa'+'re'+'.co'+'m'; return false;">kitwa<span class="obfuscator">.nosp@m.</span>re@k<span class="obfuscator">.nosp@m.</span>itwar<span class="obfuscator">.nosp@m.</span>e.co<span class="obfuscator">.nosp@m.</span>m</a>.</p>
<h1><a class="anchor" id="autotoc_md58"></a>
Contributing</h1>
<h2><a class="anchor" id="autotoc_md59"></a>
Found a bug</h2>
<p>Ask your questions and share your remarks in our issue tracker on GitLab: <a href="https://gitlab.kitware.com/physiology/unity/issues">https://gitlab.kitware.com/physiology/unity/issues</a></p>
<h2><a class="anchor" id="autotoc_md60"></a>
Can't quite make it work?</h2>
<p>You can find support on our <a href="https://discourse.kitware.com/c/pulse-physiology-engine">Discourse support forum</a>.</p>
<h2><a class="anchor" id="autotoc_md61"></a>
Have a fix you'd like to contribute back?</h2>
<p>You can follow this simple <a href="https://docs.gitlab.com/ee/workflow/forking_workflow.html">forking workflow</a>:</p><ol type="1">
<li><a href="https://docs.gitlab.com/ee/gitlab-basics/fork-project.html">Fork</a> this project in your own GitLab user or group</li>
<li>Commit the fix to a branch on top of <code>master</code></li>
<li>Push the branch on your forked repository</li>
<li>Create a <a href="https://docs.gitlab.com/ee/gitlab-basics/add-merge-request.html">merge request</a> in this repository </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
